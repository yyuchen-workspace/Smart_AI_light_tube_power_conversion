# 測試流程文檔

本文件說明 Smart AI 燈管電力換算計算器的完整測試流程，確保功能正常運作。

## 測試環境設定

### 本地開發環境測試

```bash
# 確認 Flutter 版本
flutter --version

# 安裝相依性
flutter pub get

# 執行程式碼分析
flutter analyze

# 啟動開發伺服器
flutter run -d chrome
```

### 建構測試

```bash
# 建構 Web 版本
flutter build web --release

# 檢查建構檔案
ls build/web/

# 本地伺服器測試
python3 -m http.server 8000 --directory build/web
```

## 功能測試清單

### 1. 介面載入測試

**測試項目：**
- [ ] 網頁正常載入
- [ ] 三個步驟卡片正確顯示
- [ ] 響應式設計（手機/平板/桌面）
- [ ] 所有標題和標籤正確顯示
- [ ] 狀態欄顯示預設文字："完成所有選項設定後點擊計算結果"

**測試步驟：**
1. 開啟瀏覽器訪問應用程式
2. 檢查頁面標題："智慧AI燈管電力換算"
3. 確認三個主要區塊以不同顏色顯示
4. 調整瀏覽器視窗大小測試響應式

### 2. 第一步：台電帳單資訊測試

**預設狀態測試：**
- [ ] "電力需量非營業用" 預設勾選
- [ ] "非時間電價" 預設勾選
- [ ] 夏季/非夏季 預設未勾選
- [ ] 所有結果欄位為空且禁止輸入（游標顯示禁止圖案）

**輸入測試：**
- [ ] 契約容量欄位只能輸入正數
- [ ] 最高需量欄位只能輸入正數
- [ ] 計費度數欄位只能輸入正數
- [ ] 不能輸入負數或文字

**邏輯測試：**
- [ ] 夏季和非夏季為互斥選項
- [ ] 修改任何輸入觸發重新計算提示

### 3. 第二步：燈管電力試算測試

**輸入測試：**
- [ ] 目前使用燈管瓦數只能輸入正數
- [ ] 燈管數量只能輸入正數
- [ ] AI燈管瓦數固定顯示12W

**區塊分離測試：**
- [ ] 更換前和更換後為不同的視覺區塊
- [ ] "更換AI燈管後"標題正確顯示
- [ ] 所有結果欄位禁止輸入

### 4. 第三步：攤提時間試算測試

**計價方式測試：**
- [ ] 租賃/買斷為互斥選項
- [ ] 選擇租賃時可輸入租賃價格
- [ ] 選擇買斷時可輸入買斷價格
- [ ] 燈管數量欄位正常輸入

**灰色顯示邏輯：**
- [ ] 選擇租賃：買斷總費用、多久時間攤提(月) 變灰色
- [ ] 選擇買斷：每月燈管租賃費用、每月總共可節省費用 變灰色

### 5. 計算功能測試

**驗證測試：**
- [ ] 未選擇夏季/非夏季時顯示錯誤
- [ ] 未填寫必要欄位時顯示錯誤
- [ ] 輸入負數或零時顯示錯誤
- [ ] 未選擇租賃/買斷時顯示錯誤

**計算正確性測試：**

**測試案例1：基本計算**
```
輸入：
- 夏季 ✓
- 契約容量：100 kW
- 最高需量：85 kW
- 計費度數：1000 度
- 目前燈管瓦數：40 W
- 燈管數量：50 支
- 租賃：80 元/支/月
- 燈管數量（第三步）：50 支

預期結果：
- 基本電價(約定)：23620.0
- 最高需量有超用契約容量：無超約
- 流動電價：4080.0
- 總電價：27700.0
- 每月耗電(度)：144.0
- AI燈管每月耗電(度)：14.4
- 可節電（度）：129.6
- 可節電(%)：90.0
- 預估下期帳單費用：27171.2
- 共節省電費：528.8
- 每月燈管租賃費用：4000.0
```

**測試案例2：超約計算**
```
輸入：
- 夏季 ✓
- 契約容量：80 kW
- 最高需量：100 kW
- 計費度數：1200 度
- 目前燈管瓦數：60 W
- 燈管數量：30 支
- 買斷：1500 元/支
- 燈管數量（第三步）：30 支

預期結果：
- 基本電價(約定)：18896.0
- 最高需量有超用契約容量：7086.0
- 流動電價：4896.0
- 總電價：30878.0
```

**錯誤情況測試：**
- [ ] 燈管瓦數設定導致負數帳單時顯示錯誤對話框

### 6. 狀態欄測試

**狀態變更測試：**
- [ ] 初始狀態：藍色，"完成所有選項設定後點擊計算結果"
- [ ] 修改輸入後：紅色，"務必點擊「計算結果」，重新計算！！"
- [ ] 計算成功後：綠色，"計算成功"

### 7. 背景計算過程測試

**按鈕狀態測試：**
- [ ] 未計算時點擊顯示錯誤提示
- [ ] 需要重新計算時點擊顯示錯誤提示
- [ ] 計算成功後點擊顯示計算過程對話框

**內容正確性測試：**
- [ ] 計算過程包含11個步驟
- [ ] 數值與實際計算結果一致
- [ ] 根據租賃/買斷顯示對應步驟

### 8. 數值進位測試

**進位規則測試：**
- [ ] 0.85234 → 0.9
- [ ] 1.23456 → 1.3
- [ ] 5.0 → 5.0（無小數點不變）
- [ ] 2.67891 → 2.7

### 9. 響應式設計測試

**裝置適配測試：**
- [ ] 手機版面（寬度 < 800px）：垂直排列
- [ ] 桌面版面（寬度 ≥ 800px）：適當的水平排列
- [ ] 平板裝置正常顯示
- [ ] 字體大小和間距適當

### 10. 瀏覽器相容性測試

**瀏覽器測試：**
- [ ] Chrome（最新版本）
- [ ] Firefox（最新版本）
- [ ] Safari（最新版本）
- [ ] Edge（最新版本）
- [ ] 手機瀏覽器（Chrome Mobile, Safari Mobile）

## 效能測試

### 載入效能
- [ ] 首次載入時間 < 3 秒
- [ ] 計算響應時間 < 500ms
- [ ] 記憶體使用合理

### 操作流暢度
- [ ] 輸入響應即時
- [ ] 狀態切換順暢
- [ ] 對話框開啟/關閉正常

## 回歸測試

每次程式碼變更後執行：

```bash
# 執行完整測試套件
flutter test

# 檢查程式碼品質
flutter analyze

# 建構測試
flutter build web --release

# 手動功能測試（依照上述清單）
```

## 測試報告格式

### 測試結果記錄

**日期：** YYYY-MM-DD
**測試者：** [姓名]
**版本：** [Git Commit Hash]

**測試結果：**
- 通過項目：XX/XX
- 失敗項目：XX/XX
- 阻塞問題：[描述]

**問題清單：**
1. [問題描述] - 優先級：高/中/低
2. [問題描述] - 優先級：高/中/低

**測試環境：**
- 作業系統：[Windows/macOS/Linux]
- 瀏覽器：[Chrome/Firefox/Safari] 版本
- Flutter 版本：[版本號]

## 自動化測試

### 單元測試

```bash
# 執行單元測試
flutter test test/

# 產生測試覆蓋率報告
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
```

### 整合測試

```bash
# 執行整合測試
flutter drive --target=test_driver/app.dart
```

## 部署前檢查清單

- [ ] 所有測試項目通過
- [ ] 程式碼分析無錯誤
- [ ] 建構成功無警告
- [ ] 本地測試正常
- [ ] 效能符合要求
- [ ] 瀏覽器相容性確認

---

**注意事項：**
- 測試應該在不同環境下進行
- 發現問題立即記錄並追蹤
- 定期更新測試案例
- 保持測試文檔的時效性